<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photo Booth</title>

<style>
body {
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  text-align: center;
  background: url("bg.jpeg") repeat;
  background-size: auto;
  min-height: 100vh;
}

.container { padding: 20px; }
#topGif { width: 180px; margin-bottom: 10px; }

.boxes {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin: 25px 0;
}

.box {
  width: 140px;   
  height: 180px;  
  border: 3px solid black;
  background: white;
  overflow: hidden;
}

.box img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#text {
  font-size: 26px;
  font-weight: bold;
  margin: 15px 0;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.buttons {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 15px;
}

#photoBtn {
  width: 110px;
  cursor: pointer;
  border-radius: 20px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

#resultBtn {
  padding: 10px 18px;
  font-size: 16px;
  cursor: pointer;
  border: none;
  border-radius: 10px;
  background: #333;
  color: white;
  box-shadow: 0 3px 6px rgba(0,0,0,0.3);
  display: flex;
  align-items: center;
  gap: 8px;
}

#resultBtn:hover { background: #555; }
#resultBtn img { width: 25px; height: 25px; }

#designBtn {
  position: fixed;
  bottom: 15px;
  right: 15px;
  width: 55px;
  cursor: pointer;
}

#video { display: none; }

#flash {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: white;
  opacity: 0;
  pointer-events: none;
  z-index: 9999;
}
</style>
</head>

<body>

<div id="flash"></div>

<div class="container">
  <img id="topGif" src="c1.gif">

  <div class="boxes">
    <div class="box"><img id="img1"></div>
    <div class="box"><img id="img2"></div>
    <div class="box"><img id="img3"></div>
  </div>

  <div id="text">Ready? üòÅ</div>

  <div class="buttons">
    <img id="photoBtn" src="button.gif">
    <button id="resultBtn" style="display: none;">
      <img src="small.gif" alt="icon"> Result
    </button>
  </div>
</div>

<a href="design.html">
  <img id="designBtn" src="design.png">
</a>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const btn = document.getElementById("photoBtn");
const resultBtn = document.getElementById("resultBtn");
const topGif = document.getElementById("topGif");
const textDisplay = document.getElementById("text");
const flash = document.getElementById("flash");

const boxes = [
  document.getElementById("img1"),
  document.getElementById("img2"),
  document.getElementById("img3")
];

let currentBox = 0;
let isCounting = false;
const gifs = ["c1.gif", "c2.gif", "c3.gif"];
let gifIndex = 0;

navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => { video.srcObject = stream; })
.catch(() => { alert("Please allow camera access!"); });

btn.addEventListener("click", () => {
  if (isCounting) return;
  isCounting = true;
  let count = 3;
  textDisplay.textContent = count;
  const countdown = setInterval(() => {
    count--;
    if (count > 0) {
      textDisplay.textContent = count;
    } else {
      clearInterval(countdown);
      textDisplay.textContent = "CHEEEESE!! üòÅüì∏";
      setTimeout(() => {
        flashEffect();
        takePhoto();
        isCounting = false;
      }, 500);
    }
  }, 1000);
});

function flashEffect() {
  flash.style.opacity = "1";
  setTimeout(() => { flash.style.opacity = "0"; }, 150);
}

function takePhoto() {
  if (currentBox >= boxes.length) return;

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");
  
  // Flip image for a natural mirror look
  ctx.translate(canvas.width, 0);
  ctx.scale(-1, 1);
  ctx.drawImage(video, 0, 0);

  const imageData = canvas.toDataURL("image/png");
  
  // --- THE FIX IS HERE ---
  // This saves the image so result.html can find it later
  localStorage.setItem("capturedPhoto" + currentBox, imageData);
  
  boxes[currentBox].src = imageData;
  currentBox++;

  // Update GIF
  topGif.src = gifs[gifIndex];
  gifIndex = (gifIndex + 1) % gifs.length;

  textDisplay.textContent = "Nice Shot! üòé";

  if (currentBox === 3) {
    btn.style.display = "none";
    resultBtn.style.display = "flex";
    textDisplay.textContent = "Done! View Result";
  }
}

resultBtn.addEventListener("click", () => {
  window.location.href = "result.html"; 
});
</script>

</body>
</html>