<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Booth</title>

    <style>
        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            text-align: center;
            background: url("bg.jpeg") repeat;
            background-size: auto;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Front Camera Mirror Style for the Button */
        .collection-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fff0f5;
            border: 3px solid #ff85a1;
            padding: 12px 20px;
            border-radius: 30px;
            text-decoration: none;
            color: #ff4d6d;
            font-weight: 800;
            font-size: 18px; /* Bigger for phone */
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(255, 133, 161, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .container { padding: 80px 15px 20px 15px; } 

        .boxes {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }

        /* Large boxes for phone height */
        .box {
            width: 240px; 
            height: 320px;  
            border: 5px solid #333;
            background: #222; 
            overflow: hidden;
            position: relative;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        /* THE REFLECTION MAGIC */
        .box video, .box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* This flips it like a front camera! */
        }

        .del-btn {
            position: absolute;
            top: 10px; right: 10px;
            background: #ff4d6d; color: white;
            border: 2px solid white; border-radius: 50%;
            width: 35px; height: 35px;
            font-weight: bold; cursor: pointer;
            z-index: 20; display: none;
            font-size: 18px;
        }

        #text {
            font-size: 38px; /* Huge font for easy reading */
            font-weight: 900;
            margin: 25px 0;
            color: #333;
            text-transform: uppercase;
        }

        .buttons {
            display: flex; justify-content: center;
            padding-bottom: 40px;
        }

        #photoBtn { width: 140px; cursor: pointer; transition: transform 0.2s; }
        #photoBtn:active { transform: scale(0.9); }

        #resultBtn {
            padding: 18px 30px; font-size: 22px; cursor: pointer;
            border: none; border-radius: 50px;
            background: #333; color: white;
            display: none; align-items: center; gap: 10px;
            font-weight: bold;
        }

        #flash {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: white; opacity: 0;
            pointer-events: none; z-index: 9999;
        }

        video#hidden-stream { display: none; }
    </style>
</head>

<body>
<div id="flash"></div>

<a href="collection.html" class="collection-btn">
    Collection üíï
</a>

<div class="container">
    <img id="topGif" src="c1.gif" style="width: 160px; border-radius: 20px;">

    <div class="boxes">
        <div class="box" id="box0">
            <button class="del-btn" id="del0" onclick="clearPhoto(0)">‚úï</button>
            <img id="img0">
        </div>
        <div class="box" id="box1">
            <button class="del-btn" id="del1" onclick="clearPhoto(1)">‚úï</button>
            <img id="img1">
        </div>
        <div class="box" id="box2">
            <button class="del-btn" id="del2" onclick="clearPhoto(2)">‚úï</button>
            <img id="img2">
        </div>
    </div>

    <div id="text">GET READY! üì∏</div>

    <div class="buttons">
        <img id="photoBtn" src="Button.gif">
        <button id="resultBtn">
            <img src="cat.gif" width="30"> VIEW RESULT
        </button>
    </div>
</div>

<video id="video" autoplay playsinline muted></video>
<canvas id="canvas" style="display:none;"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const btn = document.getElementById("photoBtn");
const resultBtn = document.getElementById("resultBtn");
const textDisplay = document.getElementById("text");
const flash = document.getElementById("flash");

const boxes = [
    document.getElementById("img0"),
    document.getElementById("img1"),
    document.getElementById("img2")
];

let currentBox = 0;
let isCounting = false;

function startCamera() {
    navigator.mediaDevices.getUserMedia({ 
        video: { facingMode: "user", width: { ideal: 1280 }, height: { ideal: 720 } } 
    })
    .then(stream => { 
        video.srcObject = stream;
        video.onloadedmetadata = () => {
            video.play();
            updatePreview();
        };
    })
    .catch(() => { 
        textDisplay.textContent = "Check Camera! ‚ùå";
    });
}

// Moves the camera feed to the box you are currently on
function updatePreview() {
    if (currentBox < 3) {
        const targetBox = document.getElementById("box" + currentBox);
        targetBox.appendChild(video);
        video.style.display = "block";
    } else {
        video.style.display = "none";
    }
}

startCamera();

btn.addEventListener("click", () => {
    if (isCounting || currentBox >= 3) return;
    isCounting = true;
    let count = 3;
    textDisplay.textContent = count;
    
    const countdown = setInterval(() => {
        count--;
        if (count > 0) {
            textDisplay.textContent = count;
        } else {
            clearInterval(countdown);
            textDisplay.textContent = "SMILE!! üòÅ";
            setTimeout(() => {
                flashEffect();
                takePhoto();
            }, 400);
        }
    }, 1000);
});

function flashEffect() {
    flash.style.opacity = "1";
    setTimeout(() => { flash.style.opacity = "0"; }, 150);
}

function takePhoto() {
    const w = video.videoWidth;
    const h = video.videoHeight;
    canvas.width = w;
    canvas.height = h;
    const ctx = canvas.getContext("2d");
    
    // This saves the photo ALREADY MIRRORED so it matches the preview
    ctx.translate(w, 0);
    ctx.scale(-1, 1);
    ctx.drawImage(video, 0, 0, w, h);

    const imageData = canvas.toDataURL("image/png");
    boxes[currentBox].src = imageData;
    boxes[currentBox].style.display = "block";
    document.getElementById("del" + currentBox).style.display = "block";
    
    currentBox++;
    isCounting = false;
    textDisplay.textContent = "LOVE IT! ‚ú®";

    if (currentBox === 3) {
        btn.style.display = "none";
        resultBtn.style.display = "flex";
        textDisplay.textContent = "ALL DONE! üíï";
    }
    updatePreview();
}

function clearPhoto(index) {
    if(!confirm("Want to retake this one?")) return;
    boxes[index].src = "";
    boxes[index].style.display = "none";
    document.getElementById("del" + index).style.display = "none";
    
    currentBox = index; 
    btn.style.display = "block";
    resultBtn.style.display = "none";
    textDisplay.textContent = "READY?";
    updatePreview();
}

resultBtn.addEventListener("click", () => {
    for(let i=0; i<3; i++) {
        localStorage.setItem("capturedPhoto" + i, boxes[i].src);
    }
    window.location.href = "result.html"; 
});
</script>
</body>
</html>
