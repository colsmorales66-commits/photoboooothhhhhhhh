<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Selfie Photo Booth</title>

    <style>
        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            text-align: center;
            background: url("bg.jpeg") repeat;
            background-attachment: fixed; 
            background-size: auto;
            min-height: 100vh;
        }

        .top-right-menu {
            position: fixed; 
            top: 15px;
            right: 15px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
            z-index: 100;
        }

        #collectionBtn {
            background: #ff85a2;
            color: white;
            border: 2px solid white;
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        
        #collectionBtn:hover { transform: scale(1.05); }

        .watermark {
            font-size: 11px;
            color: #333;
            font-weight: bold;
            background: rgba(255,255,255,0.6);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .container { padding: 60px 20px 20px 20px; }
        #topGif { width: 150px; margin-bottom: 10px; border-radius: 15px; }

        .boxes {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 25px 0;
        }

        .box {
            width: 140px; height: 180px;  
            border: 3px solid black;
            background: rgba(255, 255, 255, 0.8); 
            overflow: hidden;
            position: relative;
            border-radius: 10px;
        }

        .box video, .box img {
            width: 100%; height: 100%;
            object-fit: cover;
            display: none;
        }

        .mirror { transform: scaleX(-1); }

        .del-btn {
            position: absolute;
            top: 5px; right: 5px;
            background: red;
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            width: 24px; height: 24px;
            font-weight: bold;
            cursor: pointer;
            display: none; 
            z-index: 10;
        }

        #text {
            font-size: 24px; font-weight: bold;
            margin: 15px 0;
            color: #000;
            text-shadow: 1px 1px white;
        }

        .buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }

        #photoBtn { width: 110px; cursor: pointer; transition: transform 0.2s; }

        /* Modified Result Button Styling */
        #resultLink { display: none; text-decoration: none; }
        
        #resultBtn {
            padding: 12px 24px; font-size: 18px; cursor: pointer;
            border: none; border-radius: 50px;
            background: #333; color: white;
            display: flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        #video { position: fixed; opacity: 0; pointer-events: none; top: -100px; }

        #flash {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: white; opacity: 0;
            pointer-events: none; z-index: 9999;
        }
    </style>
</head>

<body>
<div id="flash"></div>

<div class="top-right-menu">
    <button id="collectionBtn" onclick="location.href='collection.html'">Collection ðŸ’•</button>
    <div class="watermark">-program by colss #forus</div>
</div>

<div class="container">
    <img id="topGif" src="c1.gif">

    <div class="boxes">
        <div class="box" id="box0">
            <button class="del-btn" onclick="clearPhoto(0)">X</button>
            <video id="view0" class="mirror" autoplay playsinline muted></video>
            <img id="img0">
        </div>
        <div class="box" id="box1">
            <button class="del-btn" onclick="clearPhoto(1)">X</button>
            <video id="view1" class="mirror" autoplay playsinline muted></video>
            <img id="img1">
        </div>
        <div class="box" id="box2">
            <button class="del-btn" onclick="clearPhoto(2)">X</button>
            <video id="view2" class="mirror" autoplay playsinline muted></video>
            <img id="img2">
        </div>
    </div>

    <div id="text">Starting Camera...</div>

    <div class="buttons">
        <img id="photoBtn" src="Button.gif">
        <a href="result.html" id="resultLink">
            <button id="resultBtn" type="button">âœ¨ View Result</button>
        </a>
    </div>
</div>

<video id="video" autoplay playsinline muted></video>
<canvas id="canvas" style="display:none;"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const btn = document.getElementById("photoBtn");
const resultLink = document.getElementById("resultLink");
const textDisplay = document.getElementById("text");
const flash = document.getElementById("flash");

const imgElements = [document.getElementById("img0"), document.getElementById("img1"), document.getElementById("img2")];
const videoPreviews = [document.getElementById("view0"), document.getElementById("view1"), document.getElementById("view2")];
const delBtns = document.querySelectorAll('.del-btn');

let currentBox = 0;
let isCounting = false;
let globalStream = null;

async function startCamera() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
        globalStream = stream;
        video.srcObject = stream;
        updateLivePreviews();
        textDisplay.textContent = "Ready? ðŸ˜";
    } catch (err) {
        textDisplay.textContent = "Camera Blocked! âŒ";
    }
}

function updateLivePreviews() {
    videoPreviews.forEach((v, i) => {
        if (i === currentBox) {
            v.srcObject = globalStream;
            v.style.display = "block";
            imgElements[i].style.display = "none";
            delBtns[i].style.display = "none";
        } else {
            v.srcObject = null;
            v.style.display = "none";
        }
    });
}

btn.addEventListener("click", () => {
    if (isCounting || currentBox >= 3) return;
    isCounting = true;
    let count = 3;
    textDisplay.textContent = count;
    const countdown = setInterval(() => {
        count--;
        if (count > 0) { textDisplay.textContent = count; } 
        else {
            clearInterval(countdown);
            textDisplay.textContent = "CHEEEESE!! ðŸ“¸";
            setTimeout(() => { flashEffect(); takePhoto(); }, 400);
        }
    }, 800);
});

function flashEffect() {
    flash.style.opacity = "1";
    setTimeout(() => { flash.style.opacity = "0"; }, 150);
}

function takePhoto() {
    const w = video.videoWidth;
    const h = video.videoHeight;
    canvas.width = w; canvas.height = h;
    const ctx = canvas.getContext("2d");
    ctx.translate(w, 0); ctx.scale(-1, 1);
    ctx.drawImage(video, 0, 0, w, h);
    const imageData = canvas.toDataURL("image/png");
    
    localStorage.setItem("capturedPhoto" + currentBox, imageData);
    imgElements[currentBox].src = imageData;
    imgElements[currentBox].style.display = "block";
    videoPreviews[currentBox].style.display = "none";
    delBtns[currentBox].style.display = "block";
    
    currentBox++;
    isCounting = false;
    
    if (currentBox < 3) {
        textDisplay.textContent = "Next! ðŸ˜Ž";
        updateLivePreviews();
    } else {
        btn.style.display = "none";
        resultLink.style.display = "block"; // Show the link wrapper
        textDisplay.textContent = "All Done! â¤ï¸";
    }
}

function clearPhoto(index) {
    if(!confirm("Retake?")) return;
    
    for(let i = index; i < 3; i++) {
        localStorage.removeItem("capturedPhoto" + i);
        imgElements[i].style.display = "none";
        imgElements[i].src = "";
        delBtns[i].style.display = "none";
    }

    currentBox = index; 
    btn.style.display = "block";
    resultLink.style.display = "none";
    updateLivePreviews();
    textDisplay.textContent = "Ready to retake? ðŸ˜";
}

startCamera();
</script>
</body>
</html>
