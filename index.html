<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photo Booth</title>

<style>
body {
  margin: 0; padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  text-align: center;
  background: url("bg.jpeg") repeat;
  background-size: auto;
  min-height: 100vh;
}

.container { padding: 20px; }
#topGif { width: 180px; margin-bottom: 10px; }

.boxes {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin: 25px 0;
}

.box {
  width: 140px; height: 180px;  
  border: 3px solid black;
  background: white;
  overflow: hidden;
  position: relative; /* Needed for the X button */
}

.box img {
  width: 100%; height: 100%;
  object-fit: cover;
  display: none; /* Hide until photo is taken */
}

/* --- DELETE BUTTON STYLE --- */
.del-btn {
  position: absolute;
  top: 5px; right: 5px;
  background: rgba(255, 0, 0, 0.8);
  color: white;
  border: none;
  border-radius: 50%;
  width: 22px; height: 22px;
  font-weight: bold;
  cursor: pointer;
  display: none; /* Only show when photo exists */
  z-index: 10;
}

#text {
  font-size: 26px; font-weight: bold;
  margin: 15px 0;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.buttons {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 15px;
}

#photoBtn { width: 110px; cursor: pointer; border-radius: 20px; }

#resultBtn {
  padding: 10px 18px; font-size: 16px; cursor: pointer;
  border: none; border-radius: 10px;
  background: #333; color: white;
  display: none; align-items: center; gap: 8px;
}

/* Hidden Video for Camera */
#video { 
    width: 1px; height: 1px; 
    position: absolute; 
    opacity: 0; 
}

#flash {
  position: fixed; top: 0; left: 0;
  width: 100%; height: 100%;
  background: white; opacity: 0;
  pointer-events: none; z-index: 9999;
}
</style>
</head>

<body>
<div id="flash"></div>

<div class="container">
  <img id="topGif" src="c1.gif">

  <div class="boxes">
    <div class="box" id="box0">
        <button class="del-btn" onclick="clearPhoto(0)">X</button>
        <img id="img1">
    </div>
    <div class="box" id="box1">
        <button class="del-btn" onclick="clearPhoto(1)">X</button>
        <img id="img2">
    </div>
    <div class="box" id="box2">
        <button class="del-btn" onclick="clearPhoto(2)">X</button>
        <img id="img3">
    </div>
  </div>

  <div id="text">Ready? üòÅ</div>

  <div class="buttons">
    <img id="photoBtn" src="Button.gif">
    <button id="resultBtn">
      <img src="cat.gif" width="25"> Result
    </button>
  </div>
</div>

<video id="video" autoplay playsinline muted></video>
<canvas id="canvas" style="display:none;"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const btn = document.getElementById("photoBtn");
const resultBtn = document.getElementById("resultBtn");
const textDisplay = document.getElementById("text");
const flash = document.getElementById("flash");

const boxes = [
  document.getElementById("img1"),
  document.getElementById("img2"),
  document.getElementById("img3")
];

let currentBox = 0;
let isCounting = false;

// CAMERA START (With Fix for Honor X9c)
function startCamera() {
    navigator.mediaDevices.getUserMedia({ 
        video: { facingMode: "user", width: 1280, height: 720 } 
    })
    .then(stream => { 
        video.srcObject = stream;
        video.onloadedmetadata = () => {
            video.play(); // Forces the stream to start
        };
    })
    .catch((err) => { 
        console.error(err);
        alert("Camera error! Please ensure no other apps (like flashlight) are using the camera."); 
    });
}

startCamera();

btn.addEventListener("click", () => {
  if (isCounting || currentBox >= 3) return;
  isCounting = true;
  let count = 3;
  textDisplay.textContent = count;
  
  const countdown = setInterval(() => {
    count--;
    if (count > 0) {
      textDisplay.textContent = count;
    } else {
      clearInterval(countdown);
      textDisplay.textContent = "CHEEEESE!! üòÅüì∏";
      setTimeout(() => {
        flashEffect();
        takePhoto();
        isCounting = false;
      }, 500);
    }
  }, 1000);
});

function flashEffect() {
  flash.style.opacity = "1";
  setTimeout(() => { flash.style.opacity = "0"; }, 150);
}

function takePhoto() {
  if (currentBox >= boxes.length) return;

  canvas.width = video.videoWidth || 640;
  canvas.height = video.videoHeight || 480;
  const ctx = canvas.getContext("2d");
  
  // Flip for natural mirror look
  ctx.translate(canvas.width, 0);
  ctx.scale(-1, 1);
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  const imageData = canvas.toDataURL("image/png");
  
  localStorage.setItem("capturedPhoto" + currentBox, imageData);
  
  boxes[currentBox].src = imageData;
  boxes[currentBox].style.display = "block";
  
  // Show the X button for this box
  document.querySelectorAll('.del-btn')[currentBox].style.display = "block";
  
  currentBox++;
  textDisplay.textContent = "Nice Shot! üòé";

  if (currentBox === 3) {
    btn.style.display = "none";
    resultBtn.style.display = "flex";
    textDisplay.textContent = "Done! View Result";
  }
}

// --- NEW CLEAR PHOTO FUNCTION ---
function clearPhoto(index) {
    if(!confirm("Delete this photo?")) return;
    
    // Remove from storage
    localStorage.removeItem("capturedPhoto" + index);
    
    // Reset the image and hide UI
    boxes[index].src = "";
    boxes[index].style.display = "none";
    document.querySelectorAll('.del-btn')[index].style.display = "none";
    
    // Reset progress
    currentBox = index; 
    btn.style.display = "block";
    resultBtn.style.display = "none";
    textDisplay.textContent = "Photo Deleted. Ready?";
}

resultBtn.addEventListener("click", () => {
  window.location.href = "result.html"; 
});
</script>
</body>
</html>
